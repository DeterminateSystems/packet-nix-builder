steps:
  - label: Terraform Plan
    command: ./enter-env.sh sh -c "cd bids && nix-shell --run 'terraform plan -out ./terraform.plan'"
    env:
      NIX_PATH: nixpkgs=channel:nixos-unstable-small
    agents:
      nixos-foundation-netboot: true
    artifact_paths:
      - "bids/terraform.plan"
  - label: Generate and Upload
    command: ./enter-env.sh ./buildkite.sh > buildkite-generated.yaml && echo buildkite-agent pipeline upload ./buildkite-generated.yaml
    agents:
      nixos-foundation-netboot: true
    
